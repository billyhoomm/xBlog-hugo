---
title: Shell脚本笔记整理(五) sed命令
subtitle: 
date: 2019-03-19
tags: ["运维", "shell"]
draft: true
---

本节记录流编辑器sed的用法，流编辑器即对标准输出或文件进行<b>逐行</b>处理。

<!--more-->

## 语法格式

1. 从输出流中读入

```shell
# option: 工具选项
# pattern: 匹配参数，匹配对应的文本行
# command: 编辑命令，对匹配的文本行进行处理
stdout | sed [option] "pattern command"
```

2. 从文件流中读入

```shell
sed [option] "pattern command" file
```

## 选项参数

1. -n，只打印模式匹配行。
2. -e，直接在命令行进行sed编辑，默认选项。
3. -f，编辑动作保存在文件中，指定文件执行。当编辑命令较多时，很好用。
4. -r，支持扩展正则表达式。
5. -i，直接修改文件内容。

## 匹配参数用法表

|匹配模式|含义|
|----------|-------------|
|10command|匹配到第10行|
|10,20command|匹配从第10行开始，到第20行结束|
|10,+5command|从第10行开始，到第16行结束|
|pattern1/command|匹配到pattern1的行|
|/pattern1/,/pattern2/command|匹配到pattern1的行开始，到匹配到pattern2的行结束|
|10,/pattern1/command|匹配从第10行开始，到匹配到pettern1的行结束|
|/pattern1/,10command|匹配到pattern1的行开始，到第10行匹配结束|

## 编辑命令选项对照表

一句话总结：对文件的操作，无非是增删改查。

<table>
    <tr>
        <th>类别</th>
        <th>编辑命令</th>
        <th>含义</th>
    </tr>
    <tr>
        <td rowspan="4">增加</td>
        <td>a</td>
        <td>行后追加</td>
    </tr>
    <tr>
        <td>i</td>
        <td>行前追加</td>
    </tr>
    <tr>
        <td>r</td>
        <td>外部文件读入，行后追加</td>
    </tr>
    <tr>
        <td>w</td>
        <td>匹配行写入外部文件</td>
    </tr>
    <tr>
        <td>删除</td>
        <td>d</td>
        <td>删除</td>
    </tr>
    <tr>
        <td rowspan="6">修改</td>
        <td>s/old/new</td>
        <td>将行内第一个old替换为new</td>
    </tr>
    <tr>
        <td>s/old/new/g</td>
        <td>将行内全部的old替换为new</td>
    </tr>
    <tr>
        <td>s/old/new/2g</td>
        <td>将行内前2个old替换为new</td>
    </tr>
    <tr>
        <td>s/old/new/ig</td>
        <td>将行内old全部替换为new，忽略大小写</td>
    </tr>
    <tr>
        <td>s/old/&new/g</td>
        <td>注意‘&’反向引用，引用old匹配到的内容</td>
    </tr>
    <tr>
        <td>s/(o)(l)(d)/\1\2\3/g</td>
        <td>同为反向引用，\1\2\3分别代表括号内内容下标</td>
    </tr>
    <tr>
        <td>查询</td>
        <td>p</td>
        <td>打印输出</td>
    </tr>
    <tr>
        <td rowspan="2">其他编辑命令</td>
        <td>=</td>
        <td>显示行号</td>
    </tr>
</table>
